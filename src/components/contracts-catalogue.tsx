import { useState } from 'react';

interface ContractPost {
  id: string;
  data: {
    author: string;
    title: string;
    description: string;
    slug: string;
    youtube_link?: string;
    thumbnail: string;
    location: string;
  };
  thumbnail_url: string;
}

interface ContractsCatalogueProps {
  contracts: ContractPost[];
  postsPerPage?: number;
}

export default function ContractsCatalogue({
  contracts,
  postsPerPage = 3,
}: ContractsCatalogueProps) {
  const [visiblePosts, setVisiblePosts] = useState(postsPerPage);
  const [isLoading, setIsLoading] = useState(false);

  const handleLoadMore = () => {
    setIsLoading(true);
    // Simulate loading delay
    setTimeout(() => {
      setVisiblePosts(prev => Math.min(prev + postsPerPage, contracts.length));
      setIsLoading(false);
    }, 500);
  };

  const hasMorePosts = visiblePosts < contracts.length;

  return (
    <div className="mb-8">
      {contracts.slice(0, visiblePosts).map((post, postIndex) => (
        <article
          key={post.id}
          className="space-y-10 border-l [border-image:linear-gradient(to_bottom,var(--color-slate-200),var(--color-slate-300),transparent)1] bg-slate-100 rounded-r-2xl p-6 mb-10"
        >
          <div className="relative mb-2 flex items-start gap-4">
            <img src={post.thumbnail_url} alt={post.data.title} className="w-1/3 rounded-lg" />
            <div className="flex flex-col gap-2">
              <header className="mb-2">
                <h2 className="text-2xl font-bold">
                  <a href={post.data.slug} className="hover:underline">
                    {post.data.title}
                  </a>
                </h2>
                <div className="flex items-center gap-2">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    height="42"
                    viewBox="0 0 721.11239 582.53467"
                    xmlnsXlink="http://www.w3.org/1999/xlink"
                    role="img"
                  >
                    <path
                      d="M719.63469,741.26733l-.153-.01452L480.3662,719.04034,262.93028,739.239a21.49791,21.49791,0,0,1-23.39415-19.41735q-.09207-.99134-.09215-1.988V200.70651a21.40162,21.40162,0,0,1,19.50937-21.40539l221.41288-20.56845.153.01452,239.11545,22.21245L937.06956,160.761a21.49792,21.49792,0,0,1,23.39429,19.41721q.0921.99142.09216,1.98819V699.29309a21.40186,21.40186,0,0,1-19.50927,21.40576Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#3f3d56"
                    />
                    <path
                      d="M572.76414,350.0441c-46.28643-33.7103-94.98727-65.67591-144.73815-95.00394l-2.49707-1.47175v99.46885H576.87376Zm-143.92791-.31421V259.36456c47.32852,27.9968,93.67273,58.37488,137.86749,90.36536Zm378.18,204.73386q-30.02664-31.21739-61.60767-61.01252Q736.702,485.22838,727.888,477.1377q-53.79025-49.412-111.11915-93.98694l-.44653-.34726H425.52892V557.26672H809.712Zm-378.18-.50434V386.11087H615.18938q55.27881,42.99975,107.5639,90.81186,9.07855,8.29728,18.03345,16.727,31.3038,29.419,61.14459,60.30969Zm378.18.50434q-30.02664-31.21739-61.60767-61.01252Q736.702,485.22838,727.888,477.1377q-53.79025-49.412-111.11915-93.98694l-.44653-.34726H425.52892V557.26672H809.712Zm-378.18-.50434V386.11087H615.18938q55.27881,42.99975,107.5639,90.81186,9.07855,8.29728,18.03345,16.727,31.3038,29.419,61.14459,60.30969ZM572.76414,350.0441c-46.28643-33.7103-94.98727-65.67591-144.73815-95.00394l-2.49707-1.47175v99.46885H576.87376Zm-143.92791-.31421V259.36456c47.32852,27.9968,93.67273,58.37488,137.86749,90.36536Zm143.92791.31421c-46.28643-33.7103-94.98727-65.67591-144.73815-95.00394l-2.49707-1.47175v99.46885H576.87376Zm-143.92791-.31421V259.36456c47.32852,27.9968,93.67273,58.37488,137.86749,90.36536Zm378.18,204.73386q-30.02664-31.21739-61.60767-61.01252Q736.702,485.22838,727.888,477.1377q-53.79025-49.412-111.11915-93.98694l-.44653-.34726H425.52892V557.26672H809.712Zm-378.18-.50434V386.11087H615.18938q55.27881,42.99975,107.5639,90.81186,9.07855,8.29728,18.03345,16.727,31.3038,29.419,61.14459,60.30969ZM261.83113,587.033v3.30737H392.45531v47.95673H261.83113v3.30737H395.76265V587.033Zm163.69779,84.33771v33.51184l3.30737-.306V674.678H938.16978v-3.30737Zm512.64086-81.03034V587.033H425.52892v54.57147H938.16978v-3.30737H428.83626V590.34033Zm-308.866-240.6105A1613.79575,1613.79575,0,0,0,428.83626,217.6422v-33.487l-3.30738.30592v33.74622l2.54673,2.80012A1610.4861,1610.4861,0,0,1,627.73247,352.69l.44653.34726H938.16978v-3.30737Zm-236.84851,0H261.83113v3.30737H395.76265V187.22276l-3.30737.30593ZM938.16978,382.8035H665.65166l3.56372,2.927q50.32928,41.41231,98.832,87.84354,6.896,6.59811,13.74219,13.30383,34.08224,33.301,66.83355,68.77655l2.72663,1.61236h86.82v-3.30737H851.55821q-32.39565-35.12421-66.1969-68.21429-6.75906-6.623-13.56817-13.155-47.45271-45.53-96.93085-86.47922H938.16978ZM261.83113,671.37067V674.678H392.45531v33.272l3.30737-.30591V671.37067Zm0-288.56717v3.30737H392.45531V553.95941H261.83113v3.30737H395.76265V382.8035Zm310.933-32.7594c-46.28643-33.7103-94.98727-65.67591-144.73815-95.00394l-2.49707-1.47175v99.46885H576.87376Zm-143.92791-.31421V259.36456c47.32852,27.9968,93.67273,58.37488,137.86749,90.36536Zm378.18,204.73386q-30.02664-31.21739-61.60767-61.01252Q736.702,485.22838,727.888,477.1377q-53.79025-49.412-111.11915-93.98694l-.44653-.34726H425.52892V557.26672H809.712Zm-378.18-.50434V386.11087H615.18938q55.27881,42.99975,107.5639,90.81186,9.07855,8.29728,18.03345,16.727,31.3038,29.419,61.14459,60.30969ZM572.76414,350.0441c-46.28643-33.7103-94.98727-65.67591-144.73815-95.00394l-2.49707-1.47175v99.46885H576.87376Zm-143.92791-.31421V259.36456c47.32852,27.9968,93.67273,58.37488,137.86749,90.36536Zm378.18,204.73386q-30.02664-31.21739-61.60767-61.01252Q736.702,485.22838,727.888,477.1377q-53.79025-49.412-111.11915-93.98694l-.44653-.34726H425.52892V557.26672H809.712Zm-378.18-.50434V386.11087H615.18938q55.27881,42.99975,107.5639,90.81186,9.07855,8.29728,18.03345,16.727,31.3038,29.419,61.14459,60.30969Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#fff"
                    />
                    <path
                      d="M608.77959,376.37775c0,41.88122-75.83267,135.18-75.83267,135.18s-75.83267-93.29876-75.83267-135.18a75.83267,75.83267,0,0,1,151.66534,0Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#008cff"
                    />
                    <path
                      d="M567.61419,373.08068a34.66638,34.66638,0,1,1-34.66638-34.66638A34.65047,34.65047,0,0,1,567.61419,373.08068Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#fff"
                      style={{ isolation: 'isolate' }}
                    />
                    <circle cx="293.50312" cy="387.1146" r="20.44185" fill="#008cff" />
                    <circle cx="489.36398" cy="100.27214" r="30.22324" fill="#ff6584" />
                    <path
                      d="M823.58447,352.14173H675.31834a3.02384,3.02384,0,0,1-.55407-.0439l70.12308-121.46324a4.90981,4.90981,0,0,1,8.54664,0l47.06138,81.51127,2.25462,3.90031Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#fff"
                    />
                    <polygon
                      points="584.141 193.409 533.519 193.409 558.369 157.313 560.157 154.713 561.052 153.413 563.306 157.313 584.141 193.409"
                      opacity="0.2"
                      style={{ isolation: 'isolate' }}
                    />
                    <path
                      d="M906.138,352.14173H777.9l24.85-36.09556,1.78829-2.60022,32.38181-47.03945c2.12294-3.08293,7.23007-3.27491,9.726-.58148a5.853,5.853,0,0,1,.46631.58148Z"
                      transform="translate(-239.4438 -158.73267)"
                      fill="#fff"
                    />
                    <circle cx="676.20989" cy="349.33488" r="15.2965" fill="#fff" />
                    <polygon
                      points="677.685 395.409 674.552 395.409 675.98 347.031 677.685 395.409"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="676.256 356.2 679.62 351.546 676.21 357.352 675.842 356.707 676.256 356.2"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="675.888 360.899 672.524 356.246 675.934 362.051 676.302 361.406 675.888 360.899"
                      fill="#cbcbcb"
                    />
                    <circle cx="632.71557" cy="327.36152" r="22.59163" fill="#fff" />
                    <polygon
                      points="634.893 395.409 630.266 395.409 632.376 323.959 634.893 395.409"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="632.784 337.5 637.751 330.628 632.716 339.202 632.172 338.249 632.784 337.5"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="632.24 344.441 627.272 337.569 632.308 346.142 632.852 345.19 632.24 344.441"
                      fill="#cbcbcb"
                    />
                    <circle cx="108.20989" cy="349.33488" r="15.2965" fill="#fff" />
                    <polygon
                      points="109.685 395.409 106.552 395.409 107.98 347.031 109.685 395.409"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="108.256 356.2 111.62 351.546 108.21 357.352 107.842 356.707 108.256 356.2"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="107.888 360.899 104.524 356.246 107.934 362.051 108.302 361.406 107.888 360.899"
                      fill="#cbcbcb"
                    />
                    <circle cx="64.71557" cy="327.36152" r="22.59163" fill="#fff" />
                    <polygon
                      points="66.893 395.409 62.266 395.409 64.376 323.959 66.893 395.409"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="64.784 337.5 69.751 330.628 64.716 339.202 64.172 338.249 64.784 337.5"
                      fill="#cbcbcb"
                    />
                    <polygon
                      points="64.24 344.441 59.272 337.569 64.308 346.142 64.852 345.19 64.24 344.441"
                      fill="#cbcbcb"
                    />
                  </svg>
                  <p className="text-sm font-bold bg-blue-400 text-white px-2 py-1 rounded-md">
                    {post.data.location}
                  </p>
                </div>
              </header>
              <p className="mb-4 text-gray-700">{post.data.description}</p>
              <footer>
                <a
                  className="text-sm font-medium text-blue-500 transition-colors hover:text-blue-600"
                  href={post.data.slug}
                >
                  Číst více <span className="tracking-normal text-blue-300">-&gt;</span>
                </a>
              </footer>
            </div>
          </div>
        </article>
      ))}

      {/* Load more button */}
      {hasMorePosts && (
        <div className="mt-12 text-center">
          <button
            onClick={handleLoadMore}
            disabled={isLoading}
            className="btn-sm min-w-[220px] bg-gray-800 py-1.5 text-gray-200 shadow-sm hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {isLoading ? (
              <>
                <svg
                  className="animate-spin -ml-1 mr-3 h-4 w-4 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    className="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    strokeWidth="4"
                  ></circle>
                  <path
                    className="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                Načítání...
              </>
            ) : (
              <>
                Načíst další
                <span className="ml-2 tracking-normal text-gray-500">↓</span>
              </>
            )}
          </button>
        </div>
      )}
    </div>
  );
}
